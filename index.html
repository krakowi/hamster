<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–¢–∞–ø–∞–ª–∫–∞ –•–æ–º—è–∫</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #ffeebc;
        text-align: center;
        margin-top: 50px;
    }

    #hamster {
        width: 250px;
        cursor: pointer;
        transition: transform 0.1s;
    }

    #hamster:active {
        transform: scale(0.9);
    }

    #balance, #nickname {
        font-size: 24px;
        margin-top: 15px;
        font-weight: bold;
    }

    #reset {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
    }

    #top {
        margin-top: 40px;
        font-size: 20px;
        font-weight: bold;
    }

    table {
        margin: 0 auto;
        border-collapse: collapse;
        margin-top: 10px;
    }

    td, th {
        border: 1px solid black;
        padding: 6px 12px;
        background: #fff8d0;
    }
</style>
</head>
<body>

<h1>–¢–∞–ø–∞–π —Ö–æ–º—è–∫–∞ üêπ</h1>

<div id="nickname"></div>

<img id="hamster" src="https://i.imgur.com/OYu8G7a.png" alt="Hamster">

<div id="balance">–ë–∞–ª–∞–Ω—Å: 0</div>

<button id="reset">–°–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>

<div id="top">–ì–ª–æ–±–∞–ª—å–Ω—ã–π –¢–û–ü</div>
<table id="topTable"></table>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>

    // üî• –í–°–¢–ê–í–¨ –°–í–û–ô FIREBASE –ö–û–ù–§–ò–ì –°–Æ–î–ê:
    const firebaseConfig = {
        apiKey: "AIzaSyCLkWSBz7VmhLiCnrojZb_TGnVm4aCpYhM",
        authDomain: "hamster-b5a40.firebaseapp.com",
        databaseURL: "https://hamster-b5a40-default-rtdb.firebaseio.com",
        projectId: "hamster-b5a40",
        storageBucket: "hamster-b5a40.firebasestorage.app",
        messagingSenderId: "506639754076",
        appId: "1:506639754076:web:67b7f7ababc23a29ff1799",
        measurementId: "G-M3WP06KKX4"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- –ù–ò–ö ---
    let nick = localStorage.getItem("hamster_nick");
    if (!nick) {
        nick = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫:");
        if (!nick || nick.trim() === "") nick = "–ë–µ–∑—ã–º—è–Ω–Ω—ã–π";
        localStorage.setItem("hamster_nick", nick);
    }
    document.getElementById("nickname").textContent = "–í–∞—à –Ω–∏–∫: " + nick;

    // --- –ë–ê–õ–ê–ù–° ---
    let balance = parseInt(localStorage.getItem("hamster_balance")) || 0;
    const balanceEl = document.getElementById("balance");
    const hamster = document.getElementById("hamster");

    function updateBalance() {
        balanceEl.textContent = "–ë–∞–ª–∞–Ω—Å: " + balance;
        localStorage.setItem("hamster_balance", balance);

        updateOnlineScore();
    }

    updateBalance();

    // --- –¢–ê–ü ---
    hamster.addEventListener("click", () => {
        balance += 1;
        updateBalance();
    });

    // --- –°–ë–†–û–° ---
    document.getElementById("reset").addEventListener("click", () => {
        balance = 0;
        updateBalance();
    });

    // üî• –û–ë–ù–û–í–ò–¢–¨ –°–ß–Å–¢ –í –ë–ê–ó–ï FIREBASE
    function updateOnlineScore() {
        firebase.database().ref("players/" + nick).set({
            nick: nick,
            score: balance
        });
    }

    // üî• –ó–ê–ì–†–£–ó–ò–¢–¨ –¢–û–ü
    firebase.database().ref("players").on("value", snapshot => {
        const data = snapshot.val();
        const list = Object.values(data || {})
            .sort((a, b) => b.score - a.score)
            .slice(0, 20);

        drawTop(list);
    });

    function drawTop(list) {
        const table = document.getElementById("topTable");
        table.innerHTML =
            "<tr><th>–ú–µ—Å—Ç–æ</th><th>–ù–∏–∫</th><th>–°—á—ë—Ç</th></tr>";

        list.forEach((p, i) => {
            table.innerHTML += `
                <tr>
                    <td>${i + 1}</td>
                    <td>${p.nick}</td>
                    <td>${p.score}</td>
                </tr>
            `;
        });
    }

</script>

</body>
</html>
